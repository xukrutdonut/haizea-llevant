<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Haizea-Llevant Digitalizado - An√°lisis Estad√≠stico</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Librer√≠a para exportar gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Test Haizea-Llevant Digitalizado</h1>
            <p class="subtitle">Evaluaci√≥n neurol√≥gica pedi√°trica con an√°lisis estad√≠stico</p>
            <div class="stats-header" id="stats-header" style="display: none;">
                <div class="stat-item">
                    <span class="stat-label">Hitos Evaluados:</span>
                    <span class="stat-value" id="hitos-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Percentil:</span>
                    <span class="stat-value" id="percentil-info">-</span>
                </div>
            </div>
        </header>

        <main>
            <div id="welcome-screen" class="screen active">
                <div class="card">
                    <h2>Bienvenido al Test Haizea-Llevant</h2>
                    <p>Esta aplicaci√≥n permite realizar evaluaciones neurol√≥gicas digitalizadas basadas en el test Haizea-Llevant.</p>
                    
                    <form id="patient-form">
                        <div class="form-group">
                            <label for="patientName">Nombre del paciente:</label>
                            <input type="text" id="patientName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="patientAge">Edad (meses):</label>
                            <input type="number" id="patientAge" min="0" max="72" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="evaluatorName">Evaluador:</label>
                            <input type="text" id="evaluatorName" required>
                        </div>
                        
                        <button type="submit" class="btn-primary">Iniciar Evaluaci√≥n</button>
                    </form>
                </div>
            </div>

            <div id="test-screen" class="screen">
                <div class="test-header">
                    <h3 id="current-area">√Årea de evaluaci√≥n</h3>
                    <div class="test-controls">
                        <button class="btn-info btn-small" onclick="toggleHaizeaReference()">üìã Ver tabla Haizea-Llevant</button>
                    </div>
                    <div class="progress-bar">
                        <div class="progress" id="progress"></div>
                    </div>
                </div>

                <div class="test-content">
                    <div id="test-question"></div>
                    <div class="test-actions">
                        <button class="btn-success" onclick="recordResult('pass')">‚úì Superado</button>
                        <button class="btn-warning" onclick="recordResult('partial')">~ Parcial</button>
                        <button class="btn-danger" onclick="recordResult('fail')">‚úó No superado</button>
                    </div>
                </div>

                <!-- Panel de referencia de Haizea-Llevant (oculto por defecto) -->
                <div id="haizea-reference-panel" class="reference-panel" style="display: none;">
                    <div class="reference-header">
                        <h4>üìã Tabla de Referencia Haizea-Llevant</h4>
                        <button class="btn-close" onclick="toggleHaizeaReference()">‚úï</button>
                    </div>
                    <div class="reference-content">
                        <div class="patient-age-ref">
                            <strong>Edad del paciente: <span id="ref-patient-age">-</span> meses</strong>
                        </div>
                        <div id="current-hito-context"></div>
                    </div>
                </div>
            </div>

            <div id="results-screen" class="screen">
                <div class="card">
                    <h2>üìä Resultados de la Evaluaci√≥n</h2>
                    
                    <!-- Navegaci√≥n por pesta√±as en resultados -->
                    <div class="results-tabs">
                        <button class="tab-button active" onclick="showResultTab('summary')">üìã Resumen</button>
                        <button class="tab-button" onclick="showResultTab('statistics')">üìä Estad√≠sticas</button>
                        <button class="tab-button" onclick="showResultTab('charts')">üìà Gr√°ficos</button>
                        <button class="tab-button" onclick="showResultTab('percentiles')">üìâ Percentiles</button>
                        <button class="tab-button" onclick="showResultTab('haizea-table')">üìã Tabla Haizea-Llevant</button>
                    </div>

                    <!-- Contenido de pesta√±as -->
                    <div id="summary-tab" class="result-tab-content active">
                        <div id="results-summary"></div>
                        <div class="result-actions">
                            <button class="btn-primary" onclick="newTest()">Nueva Evaluaci√≥n</button>
                            <button class="btn-secondary" onclick="downloadResults()">Descargar JSON</button>
                            <button class="btn-secondary" onclick="downloadPDF()">Descargar PDF</button>
                        </div>
                    </div>

                    <div id="statistics-tab" class="result-tab-content">
                        <div id="statistical-analysis">
                            <h3>üìà An√°lisis Estad√≠stico Detallado</h3>
                            <div id="analysis-content"></div>
                        </div>
                    </div>

                    <div id="charts-tab" class="result-tab-content">
                        <h3>üìä Representaci√≥n Gr√°fica del Desarrollo</h3>
                        <div class="chart-controls">
                            <select id="chart-area-filter" onchange="updateChart()">
                                <option value="all">Todas las √°reas</option>
                                <option value="socializacion">Socializaci√≥n</option>
                                <option value="lenguaje">Lenguaje</option>
                                <option value="motricidad_gruesa">Motricidad Gruesa</option>
                                <option value="motricidad_fina">Motricidad Fina</option>
                                <option value="resolucion_problemas">Resoluci√≥n de Problemas</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="development-chart" width="800" height="400"></canvas>
                        </div>
                    </div>

                    <div id="percentiles-tab" class="result-tab-content">
                        <h3>üìâ An√°lisis de Percentiles por Hito</h3>
                        <div id="percentiles-table"></div>
                    </div>

                    <div id="haizea-table-tab" class="result-tab-content">
                        <h3>üìã Tabla Haizea-Llevant - Posici√≥n del Paciente</h3>
                        <div class="haizea-controls">
                            <div class="patient-age-indicator">
                                <span class="age-label">Edad del paciente:</span>
                                <span class="age-value" id="patient-age-display">-</span>
                                <span class="age-unit">meses</span>
                            </div>
                            <div class="haizea-legend">
                                <div class="legend-item">
                                    <span class="legend-color patient-age-marker"></span>
                                    <span>Edad cronol√≥gica del paciente</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-passed"></span>
                                    <span>Hito superado</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-partial"></span>
                                    <span>Hito parcial</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-failed"></span>
                                    <span>Hito no superado</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-not-evaluated"></span>
                                    <span>No evaluado</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="haizea-summary-stats" id="haizea-summary-stats" style="display: none;">
                            <div class="summary-card">
                                <h4>üìà Resumen del desarrollo</h4>
                                <div class="development-summary">
                                    <div class="stat-row">
                                        <span class="stat-label">Hitos esperados para la edad:</span>
                                        <span class="stat-value" id="expected-hitos">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Hitos superados:</span>
                                        <span class="stat-value" id="passed-hitos">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Desarrollo general:</span>
                                        <span class="stat-value development-status" id="general-development">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="haizea-table-container">
                            <div class="haizea-table-wrapper">
                                <div id="haizea-visual-table"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>