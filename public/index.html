<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Haizea-Llevant Digitalizado - An√°lisis Estad√≠stico</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Chart.js para gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Librer√≠a para exportar gr√°ficos -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† Test Haizea-Llevant Digitalizado</h1>
            <p class="subtitle">Evaluaci√≥n neurol√≥gica pedi√°trica con an√°lisis estad√≠stico</p>
            <div class="stats-header" id="stats-header" style="display: none;">
                <div class="stat-item">
                    <span class="stat-label">Hitos Evaluados:</span>
                    <span class="stat-value" id="hitos-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">% de hitos superados:</span>
                    <span class="stat-value" id="percentil-info">-</span>
                </div>
            </div>
        </header>

        <main>
            <div id="welcome-screen" class="screen active">
                <div class="card">
                    <h2>Bienvenido al Test Haizea-Llevant</h2>
                    <p>Esta aplicaci√≥n permite realizar evaluaciones neurol√≥gicas digitalizadas basadas en el test Haizea-Llevant.</p>
                    
                    <form id="patient-form">
                        <div class="form-group">
                            <label for="patientName">Nombre del paciente:</label>
                            <input type="text" id="patientName" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="patientAge">Edad (meses):</label>
                            <input type="number" id="patientAge" min="0" max="72" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="evaluatorName">Evaluador:</label>
                            <input type="text" id="evaluatorName" required>
                        </div>
                        
                        <button type="submit" class="btn-primary">Iniciar Evaluaci√≥n</button>
                    </form>
                </div>
            </div>

            <div id="test-screen" class="screen">
                <div class="test-header">
                    <h3 id="current-area">√Årea de evaluaci√≥n</h3>
                    <div class="test-controls">
                        <button class="btn-info btn-small" onclick="toggleHaizeaReference()">üìã Ver tabla Haizea-Llevant</button>
                    </div>
                    <div class="progress-bar">
                        <div class="progress" id="progress"></div>
                    </div>
                </div>

                <div class="test-content">
                    <div id="test-question"></div>
                    <div class="test-actions">
                        <button class="btn-success" onclick="recordResult('pass')">‚úì Superado</button>
                        <button class="btn-warning" onclick="recordResult('partial')">~ Parcial</button>
                        <button class="btn-danger" onclick="recordResult('fail')">‚úó No superado</button>
                    </div>
                </div>

                <!-- Panel de referencia de Haizea-Llevant (oculto por defecto) -->
                <div id="haizea-reference-panel" class="reference-panel" style="display: none;">
                    <div class="reference-header">
                        <h4>üìã Tabla de Referencia Haizea-Llevant</h4>
                        <button class="btn-close" onclick="toggleHaizeaReference()">‚úï</button>
                    </div>
                    <div class="reference-content">
                        <div class="patient-age-ref">
                            <strong>Edad del paciente: <span id="ref-patient-age">-</span> meses</strong>
                        </div>
                        <div id="current-hito-context"></div>
                    </div>
                </div>
            </div>

            <div id="results-screen" class="screen">
                <div class="card">
                    <h2>üìä Resultados de la Evaluaci√≥n</h2>
                    
                    <!-- Navegaci√≥n por pesta√±as en resultados -->
                    <div class="results-tabs">
                        <button class="tab-button active" onclick="showResultTab('summary')">üìã Resumen</button>
                        <button class="tab-button" onclick="showResultTab('statistics')">üìä Estad√≠sticas</button>
                        <button class="tab-button" onclick="showResultTab('charts')">üìà Gr√°ficos</button>
                        <button class="tab-button" onclick="showResultTab('percentiles')">üìâ Percentiles</button>
                        <button class="tab-button" onclick="showResultTab('haizea-graphic')">üìä Gr√°fica Original</button>
                        <button class="tab-button" onclick="showResultTab('haizea-table')">üìã Tabla Visual</button>
                        <button class="tab-button" onclick="showResultTab('haizea-official')">üìã Tabla Oficial</button>
                    </div>

                    <!-- Contenido de pesta√±as -->
                    <div id="summary-tab" class="result-tab-content active">
                        <div id="results-summary"></div>
                        <div class="result-actions">
                            <button class="btn-primary" onclick="newTest()">Nueva Evaluaci√≥n</button>
                            <button class="btn-secondary" onclick="downloadResults()">Descargar JSON</button>
                            <button class="btn-secondary" onclick="downloadPDF()">Descargar PDF</button>
                        </div>
                    </div>

                    <div id="statistics-tab" class="result-tab-content">
                        <div id="statistical-analysis">
                            <h3>üìà An√°lisis Estad√≠stico Detallado</h3>
                            <div id="analysis-content"></div>
                        </div>
                    </div>

                    <div id="charts-tab" class="result-tab-content">
                        <h3>üìä Representaci√≥n Gr√°fica del Desarrollo</h3>
                        <div class="chart-controls">
                            <select id="chart-area-filter" onchange="updateChart()">
                                <option value="all">Todas las √°reas</option>
                                <option value="socializacion">Socializaci√≥n</option>
                                <option value="lenguaje">Lenguaje</option>
                                <option value="motricidad_gruesa">Motricidad Gruesa</option>
                                <option value="motricidad_fina">Motricidad Fina</option>
                                <option value="resolucion_problemas">Resoluci√≥n de Problemas</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="development-chart" width="800" height="400"></canvas>
                        </div>
                    </div>

                    <div id="percentiles-tab" class="result-tab-content">
                        <h3>üìâ An√°lisis de Percentiles por Hito</h3>
                        <div id="percentiles-table"></div>
                    </div>

                    <div id="haizea-graphic-tab" class="result-tab-content">
                        <h3>üìä Tabla Gr√°fica Haizea-Llevant - Representaci√≥n Visual</h3>
                        <div class="graphic-chart-controls">
                            <div class="patient-age-info">
                                <span class="age-label">üë∂ Paciente:</span>
                                <span class="age-value" id="graphic-patient-name">-</span>
                                <span class="age-separator">|</span>
                                <span class="age-label">üìÖ Edad:</span>
                                <span class="age-value" id="graphic-patient-age">-</span>
                                <span class="age-unit">meses</span>
                            </div>
                            <div class="chart-zoom-controls">
                                <button class="btn-zoom" onclick="zoomGraphicChart(0.8)">üîç-</button>
                                <span id="graphic-zoom-level">100%</span>
                                <button class="btn-zoom" onclick="zoomGraphicChart(1.2)">üîç+</button>
                                <button class="btn-zoom" onclick="resetZoomGraphicChart()">‚Ü∫ Reset</button>
                            </div>
                        </div>
                        
                        <div class="graphic-legend">
                            <div class="legend-row">
                                <div class="legend-item">
                                    <div class="legend-line graphic-age-line"></div>
                                    <span>Edad cronol√≥gica del paciente</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-point graphic-hito-passed"></div>
                                    <span>Hito superado</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-point graphic-hito-partial"></div>
                                    <span>Hito parcial</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-point graphic-hito-failed"></div>
                                    <span>Hito no superado</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="graphic-chart-container" id="graphic-chart-container">
                            <div class="graphic-chart-wrapper" id="graphic-chart-wrapper">
                                <!-- L√≠nea de edad cronol√≥gica -->
                                <div class="age-line-graphic-container" id="age-line-graphic-container">
                                    <div class="age-line-graphic-vertical" id="age-line-graphic-vertical"></div>
                                    <div class="age-label-graphic-marker" id="age-label-graphic-marker">
                                        <span id="age-marker-graphic-text">12m</span>
                                    </div>
                                </div>
                                <!-- Imagen de la tabla gr√°fica -->
                                <img id="haizea-graphic-img" 
                                     src="tabla_haizea_grafica_horizontal.png" 
                                     alt="Tabla Gr√°fica Haizea-Llevant"
                                     onload="initializeGraphicChart()" 
                                     draggable="false">
                                <!-- Overlay para puntos de hitos evaluados -->
                                <div class="hitos-graphic-overlay" id="hitos-graphic-overlay"></div>
                            </div>
                        </div>
                        
                        <div class="graphic-instructions">
                            <h4>üìñ C√≥mo interpretar la gr√°fica original:</h4>
                            <ul>
                                <li><strong>L√≠nea roja vertical:</strong> Marca la edad cronol√≥gica de tu paciente</li>
                                <li><strong>Eje horizontal:</strong> Representa la edad en meses (0-72 meses)</li>
                                <li><strong>Eje vertical:</strong> Muestra las diferentes √°reas de desarrollo</li>
                                <li><strong>Curvas de percentiles:</strong> Las l√≠neas curvas muestran el desarrollo t√≠pico (P25, P50, P75, P90)</li>
                                <li><strong>Puntos coloreados:</strong> Representan los hitos evaluados del paciente superpuestos en la gr√°fica</li>
                                <li><strong>Zoom:</strong> Utiliza los controles para acercarte y ver detalles espec√≠ficos</li>
                            </ul>
                        </div>
                    </div>

                    <div id="haizea-table-tab" class="result-tab-content">
                        <h3>üìã Tabla Haizea-Llevant - Posici√≥n del Paciente</h3>
                        <div class="haizea-controls">
                            <div class="patient-age-indicator">
                                <span class="age-label">Edad del paciente:</span>
                                <span class="age-value" id="patient-age-display">-</span>
                                <span class="age-unit">meses</span>
                            </div>
                            <div class="haizea-legend">
                                <div class="legend-item">
                                    <span class="legend-color patient-age-marker"></span>
                                    <span>Edad cronol√≥gica del paciente</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-passed"></span>
                                    <span>Hito superado</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-partial"></span>
                                    <span>Hito parcial</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-failed"></span>
                                    <span>Hito no superado</span>
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color hito-not-evaluated"></span>
                                    <span>No evaluado</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="haizea-summary-stats" id="haizea-summary-stats" style="display: none;">
                            <div class="summary-card">
                                <h4>üìà Resumen del desarrollo</h4>
                                <div class="development-summary">
                                    <div class="stat-row">
                                        <span class="stat-label">Hitos esperados para la edad:</span>
                                        <span class="stat-value" id="expected-hitos">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Hitos superados:</span>
                                        <span class="stat-value" id="passed-hitos">-</span>
                                    </div>
                                    <div class="stat-row">
                                        <span class="stat-label">Desarrollo general:</span>
                                        <span class="stat-value development-status" id="general-development">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="haizea-table-container">
                            <div class="haizea-table-wrapper">
                                <div id="haizea-visual-table"></div>
                            </div>
                        </div>
                    </div>

                    <div id="haizea-official-tab" class="result-tab-content">
                        <h3>üìã Tabla Oficial Haizea-Llevant - Posici√≥n del Ni√±o</h3>
                        <div class="official-table-controls">
                            <div class="patient-info-official">
                                <div class="patient-age-official">
                                    <span class="age-label">üë∂ Paciente:</span>
                                    <span class="age-value" id="official-patient-name">-</span>
                                    <span class="age-separator">|</span>
                                    <span class="age-label">üìÖ Edad:</span>
                                    <span class="age-value" id="official-patient-age">-</span>
                                    <span class="age-unit">meses</span>
                                </div>
                            </div>
                            <div class="zoom-controls">
                                <button class="btn-zoom" onclick="zoomOfficial(0.8)">üîç-</button>
                                <span id="zoom-level">100%</span>
                                <button class="btn-zoom" onclick="zoomOfficial(1.2)">üîç+</button>
                                <button class="btn-zoom" onclick="resetZoomOfficial()">‚Ü∫ Reset</button>
                            </div>
                        </div>
                        
                        <div class="official-legend">
                            <div class="legend-row">
                                <div class="legend-item">
                                    <div class="legend-line age-line-official"></div>
                                    <span>Edad cronol√≥gica del paciente</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-point hito-passed-official"></div>
                                    <span>Hito superado</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-point hito-partial-official"></div>
                                    <span>Hito parcial</span>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-point hito-failed-official"></div>
                                    <span>Hito no superado</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="official-table-container" id="official-table-container">
                            <div class="official-table-wrapper">
                                <div class="age-line-container" id="age-line-container">
                                    <div class="age-line-vertical" id="age-line-vertical"></div>
                                    <div class="age-label-marker" id="age-label-marker">
                                        <span id="age-marker-text">12m</span>
                                    </div>
                                </div>
                                <img id="haizea-official-img" 
                                     src="tabla_haizea_horizontal.png" 
                                     alt="Tabla Oficial Haizea-Llevant"
                                     onload="initializeOfficialTable()" 
                                     draggable="false">
                                <div class="hitos-overlay" id="hitos-overlay"></div>
                            </div>
                        </div>
                        
                        <div class="official-instructions">
                            <h4>üìñ C√≥mo interpretar la tabla:</h4>
                            <ul>
                                <li><strong>L√≠nea roja vertical:</strong> Marca la edad cronol√≥gica de tu paciente</li>
                                <li><strong>Puntos coloreados:</strong> Representan los hitos evaluados del paciente</li>
                                <li><strong>Bandas de color:</strong> Muestran los percentiles normales de desarrollo (P25, P50, P75, P90)</li>
                                <li><strong>Zoom:</strong> Usa los controles para acercarte y ver detalles espec√≠ficos</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>